### 일평균수익률 [G]

### 누적수익률 [G]


### CAGR [G]
**Compound Annual Growth Rate**의 약자이며, 통상적으로 **연평균 수익률** 의미한다.

수익률은 연마다 곱하기로 계산되기 때문에 우리가 평소에 하는 평균내는 방법이랑 조금 다르다.
2년동안 21%의 수익이 났다면 연평균 수익률은 10.5%가 아니라 10%이다.(`1.10 x 1.10 = 1.21`)

평균이기 때문에 CAGR이 양의 값이여도 실제로 중간에 음의 수익률을 기록한 기간도 존재할 수 있다.
CAGR은 높을 수록 좋지만, CAGR이 20~30%를 넘어간다면 뭔가 의심을 해봐야한다.
그 자산은 아마 변동성, 즉 오르내림이 매우 심한 자산일 것이다.

```python
lstm_book_df['lstm_ret'] = lstm_book_df['next_rtn'] * lstm_book_df['position'].shift(1)
lstm_book_df['lstm_cumret'] = (lstm_book_df['lstm_ret'] + 1).cumprod()
CAGR = lstm_book_df.loc[lstm_book_df.index[-1], 'lstm_cumret'] ** (252. / len(lstm_book_df.index)) - 1
```

![](./images/cagr.png)

### MDD [G]
MDD는 **Maximum Drawdown**의 약자이며, **최대낙폭**이라고 한다.

수익률 곡선이 최고점을 찍고 최대 몇%까지 손해보았는지에 대한 지표이다.
예를 들어 MDD가 60% 라면 재산이 최대 -60%도 찍어본 적이 있다는 의미이다 (MDD로만은 회복 여부에 대해서는 알 수 없다).
따라서 MDD는 낮을 수록 좋다.

```python
historical_max = lstm_book_df['Close'].cummax()
daily_drawdown = lstm_book_df['Close'] / historical_max - 1.0
historical_dd = daily_drawdown.cummin()
MDD = historical_dd.min()
```

![](./images/mdd.png)

### Sharpe
수익률은 높으면서 변동성은 낮기를 원한다.
Sharpe 지수는 수익률은 높은 것에 비해 변동성은 낮은 자산을 찾고자 만들어진 지표다.


수익률을 변동성(수익률의 표준편차)으로 나눈 것이다.
분자에 수익률, 분모에 변동성이 들어가니 자연스럽게 샤프지수가 커지면 커질 수록 안정적인 자산이라고 할 수 있다.

```python
lstm_book_df['lstm_ret'] = lstm_book_df['next_rtn'] * lstm_book_df['position'].shift(1)
Sharpe = np.mean(lstm_book_df['lstm_ret']) / np.std(lstm_book_df['lstm_ret']) * np.sqrt(252.)
```

![](./images/sharpe.png)



### VOL
변동성
```python
lstm_book_df['lstm_ret'] = lstm_book_df['next_rtn'] * lstm_book_df['position'].shift(1)
VOL = np.std(lstm_book_df['lstm_ret']) * np.sqrt(252.)
```

# 서비스별 지원하는 백테스팅 평가 지표

### 젠포트

| 평가항목 | 설명 |
| -- | -- |
| 	종목 실현손익금 |  매도 종목의 손익률을 통해 실현 손익금 계산	 |
| 	평균손익 | 평균손익 = (총수익 + 총손실) / 총 매매수 = 총손익 / 총 매매수<br>* 모든 거래에 대한 평균수익 혹은 평균손실의 금액 |
| 	최대손실 | 전 거래기간 동안 발생할 수 있는 시스템의 잠재적인 최대손실<br>* 즉, 해당 전략으로 거래하는 경우 전 거래기간을 통해 파산 위험 없이 지속적으로 거래하기 위해 필요한 금액<br>* 일중을 기준으로 청산된 거래의 누적 손실액의 합계, 소위 수익률 곡선의 고점에서 저점까지의 하락이 가장 큰 금액으로 산출(일반적으로 종가를 기준으로 산출) |
| 	총 매매수 | 적절한 총거래 건수가 발생하도록 전략을 조정하는 것이 필요<br>* 통계적 신뢰를 받기 위해서는 최소 30건이상의 총거래 횟수 필요 |
| 	승률 | 모든 거래에서 수익을 실현한 비율<br>* 승률(Percent profitable) = 총수익거래 건수 / 총거래 건수 x 100<br>(미실현 손익(Open Position Profit/Loss) 제외) |
| 	손익비 | 순수익(Gross Profit) = 거래를 통해 실현된 수익의 누계<br>* 순손실(Gross Loss) = 거래를 통해 실현된 손실의 누계<br>* 손익비 = 순수익 / 순손실<br>(미실현 손익(Open Position Profit/Loss) 제외) |
| 	평균손익비 | 평균수익 대 평균손실 비율 = 수익거래당 평균수익거래 금액 / 손실거래당 평균손실거래 금액<br>* 수익거래당 평균수익거래금액(Average Winning Trade) = 실현된 총수익거래의 수익금액을 합계한 순수익액(Gross Profit) / 총수익거래 건수(Number of Winning Trades)<br>* 손실거래당 평균손실거래금액(Average Losing Trade) = 실현된 총손실거래의 손실금액을 합계한 순손실액(Gross Loss) / 총손실거래 건수(Number of Losing Trades) |
| 	보상비율 | 매매기간 중 발생하는 위험대비 보상비율을 산출한 것으로서 보상비율이 1미만인 경우 위험이 크고 보상은 적은 매우 좋지 않은 전략 시스템이라 판단 할 수 있음<br>보상비율이 클수록 위험에 대한 보상률이 크며 안정적인 수익을 가져다 준다고 할 수 있음<br>보상비율 = 총손익 / 최대자본인하액 |
| 	CPC Index | CPC Index = 승률 x 손익비 x 평균손익비 <br> * Sunny Harris가 개발한 방법 |
| 	Sharpe Ratio | 샤프지수  =  ( (일일수익률-일환산CD금리)의 평균 / (일일수익률 - 일환산CD금리)의 표준편차 ) * (250 ^ 0.5) |
| 	수익 월 개수 | 운영 기간동안 수익률이 0보다 큰 월의 개수 |
| 	손실 월 개수 | 운영 기간동안 수익률이 0보다 작은 월의 개수	 |
| 	월 평균 수익률 | 운영 기간동안 수익률이 0보다 큰 월별 수익률들의 평균	 |
| 	월 평균 손실률 | 운영 기간동안 수익률이 0보다 작은 월별 수익률들의 평균 |
| 	최대 연속 수익 금액 | 일별 최대 자산 변동 내역이 연속으로 0보다 큰 금액의 합	 |
| 	최대 연속 손실 금액 | 일별 최대 자산 변동 내역이 연속으로 0보다 작은 금액의 합	 |
| 	최대 연속 손실 구간 | 일별 최대 자산 변동 내역이 연속으로 0보다 작은 구간중 가장 높은 구간 |
| 	최대 낙폭 | MDD(MaxDrawDown), 역사적 최고점에서의 하락폭중 가장 높은 낙폭 |
| 	최대 낙폭 구간 | 최대 낙폭(MDD)이 발생한 구간 |
| 	Recovery Period | MDD 발생일 이후 다시 최고점 돌파 기간 |
| 	Underwater Period | MDD 최고점 날짜 이후 다시 최고점 돌파 기간 |
| 	CAGR | 특정기간동안 투자의 연평균성장률 |
| 	KOSPI 상관성 | 운영 기간동안 일일수익률과 KOSPI 일일상승률의 피어슨 상관계수 값 |
| 	KOSDAQ 상관성 | 운영 기간동안 일일수익률과 KOSDAQ 일일상승률의 피어슨 상관계수 값 |
| 	상승일 비율 | 운영 기간동안 0보다 큰 일일수익률의 비율	 |
| 	하락일 비율 | 운영 기간동안 0보다 낮은 일일수익률의 비율 |
| 	월 평균 손익률 | 월별 수익률의 전체 평균	 |
| 	월 표준편차 | 월별 수익률의 표준편차	 |
| 	일 표준편차 | 일별 수익률의 표준편차	 |
| 	고점 대비 횡보비율 | 역사적 고점보다 낮은 기간의 비율 |

### 트레이딩뷰

#### 빌트인 스크립트 이름

| 지표 | 필요한 컬럼 |
| -- | -- |
| Auto Fib Extension |   |
| Auto Fib Retracement |   |
| Directional Movement Index |   |
| Ease of Movement |   |
| Elders Force Index |   |
| Envelope |   |
| Keltner Channels Strategy |   |
| MA 크로스 (MA Cross) |   |
| MACD |   |
| MACD 전략 (MACD Strategy) |   |
| MovingAvg2Line 크로스 (MovingAvg2Line Cross ) |   |
| Rob Booker - ADX Breakout |   |
| Rob Booker - Intraday Pivot Points |   |
| Rob Booker - Knoxville Divergence |   |
| Rob Booker - Missed Pivot Points |   |
| Rob Booker - Reversal |   |
| Rob Booker - Ziv Ghost Pivots |   |
| RSI 스트래티지 (RSI Strategy) |   |
| SMI 에르고딕 오실레이터 (SMI Ergodic Oscillator) |   |
| SMI 에르고딕 인디케이터 (SMI Ergodic Indicator) |   |
| Williams Fractals |   |
| 가격 거래량 트렌드 (Price Volume Trend) |   |
| 가중 이동 평균 (Moving Average Weighted) |   |
| 거래량 (Volume) |   |
| 거래량 가중이동평균 |   |
| 과거변동성 (Historical Volatility) |   |
| 그리디 스트래티지 (Greedy Strategy) |   |
| 노우 슈어 씽 (Know Sure Thing) |   |
| 누적/분포 (Accumulation/Distribution) |   |
| 누적거래량지수 (Cumulative Volume Index) |   |
| 다이버전스 인디케이터 (Divergence Indicator) |   |
| 더블 EMA (Double EMA) |   |
| 돈치안 채널 (Donchian Channels) |   |
| 디트렌디드 프라이스 오실레이터 (Detrended Price Oscillator) |   |
| 레이트 오브 체인지 (Rate Of Change) |   |
